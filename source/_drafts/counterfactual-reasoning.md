---
title: 反事实推断背后的原理探究
tags:
---



## 因果推断和do-Calculus

### 因果推断

基础概念：

-   observational $p(y \mid x)$ : 基于一个自然发生的x对y进行推断。
-   interventional $p(y \mid d o(x))$ : 基于变量控制法，对于所有可能的x（可能不是自然发生的）进行假设，去估计可能取得的y值。但是实际条件不允许我们根据控制变量法进行实验。

>   因果推断的主要目标：在无法进行控制变量实验得到$p(y \mid d o(x))$的结果的前提下，我们是否能根据以往的观测来推测得到这个概率值。即它回答的问题是："what-if-we-did-x"，就像英语中的虚拟语气

主要做法如下：

当前能够获得的数据仅仅是历史联合分布的数据，即蓝色连线的因子图，我们可以通过监督学习得到左下角的观测条件概率$p(y \mid x)$；而我们的目标是得到干涉后的条件概率，即右下角的$p(y \mid d o(x))$，这个概率一般只能通过右上角的红色联合分布来获得。

![](https://gitblog-1302688916.cos.ap-beijing.myqcloud.com/cs224n/202103/18/154935-964879.png)

>   因此我们的目标是建立蓝色联合分布和红色联合分布之间的关系；进一步来说是探究我们进行变量干涉后**do(x)**之后，其余变量所作出的相应改变。即变量间的逻辑关系**R**。

### 因果模型

这种关系**R**无法单单从蓝色的联合分布中捕捉，需要引入更加有用的工具，即因果模型。它会对联合分布进行更高一层的抽象，如下所示：

![](https://gitblog-1302688916.cos.ap-beijing.myqcloud.com/cs224n/202103/18/162739-319929.png)

>   注意因果图和联合分布是多对一的关系，多个因果图可以符合同一个联合分布。因为仅仅通过观测数据分布，我们无法确定性的得出唯一的因果关系。

其中因果图反应了变量间相呼影响的关系，因果图的构建是基于现实世界中的关系人为构建的（因此它是我们训练模型时的一种**先验知识**）。概率分布中的do操作映射在因果图中即为破坏因果图中的边。**do(x)**即为消去所有连向x节点的边。此时要求的红色的分布和条件概率分布就可以用来近似绿色的条件概率分布。

### do-Calculus

do操作会在条件概率中引入四条规则，根据[paper]()，我们可以得出公式
$$
\tilde{p}(y \mid d o(x))
$$
最终将不再包含**do( )**的操作，即此时的x，y的值均是可以直接从蓝色的可观测分布中获得的。此时整体的图示如下所示：

![](https://gitblog-1302688916.cos.ap-beijing.myqcloud.com/cs224n/202103/18/170327-417022.png) 





## 通过一个例子来解释干预（Interventions）

>   监督学习学习的条件分布 $p(y \mid x)$，整个模型学到的是 (x,y) 的联合分布。然后在这个基础上得出条件预测概率 $p(y \mid x)$。而干预操作中 $p(y \mid d o(x))$ ，(x, y)已经不再符合之前的联合分布了，这时候我们应该通过因果模型来推断x与y之间的关系。在得到x与y的关系的基础上，利用原来的联合分布的数据，得到我们的目标$p(y \mid d o(x))$

![](https://gitblog-1302688916.cos.ap-beijing.myqcloud.com/cs224n/202103/19/090935-884234.png)

因此$p(y \mid x)$和$p(y \mid d o(x))$分别能解决的问题如上图所示，加入了graph assumption（因果推断）后能够回答比原来更多的问题。



## 反事实推断

>   举个栗子：已知希拉里在2016年的选举的三天前没有去参观芝加哥，同时她在选举中败选。现在我们的目标是想判断**没有去参观芝加哥**是否与**选举败选**有关，同时对这种影响程度进行**量化**。

### 干预查询

-   干预查询：属于一种整体分布，是针对任何一个人而言的概率
-   反事实查询：针对一个特定的人而言的概率，即具有"persdonalized"的属性；如果把所有人得反事实查询概率的结果平均，将会对得到干预查询的结果   

### 反事实查询











